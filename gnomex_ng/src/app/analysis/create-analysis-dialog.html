<div class="full-height full-width flex-container-col">
    <div mat-dialog-title class="dialog-header-colors no-padding no-margin">
        <div class="flex-container-row">
            <div class="full-height padded title-size" style="width: 95%;">
                <img class="icon" [src]="this.constantsService.ICON_ANALYSIS_ADD">Add Analysis
            </div>
            <div class="right-align">
                <button mat-button mat-dialog-close>
                    <img class="icon" [src]="this.constantsService.ICON_CLOSE_BLACK">
                </button>
            </div>
        </div>
    </div>
    <div mat-dialog-content class="flex-grow no-padding no-margin">
        <div class="full-width full-height flex-container-col double-padded">

            <form class="full-height full-width padded-inner flex-container-col" [formGroup]="createAnalysisForm" >
                <div class="flex-container-row align-center padded">
                    <label class="label label-width">Group</label>
                    <jqxComboBox #labCombo class="inlineComboBox" [width]="350" [placeHolder]="'Select a lab...'"
                                 [source]="labList" [displayMember]="this.prefService.labDisplayField" [valueMember]="'idLab'"
                                 (onSelect)="onLabSelect($event)" formControlName="selectedLab">
                    </jqxComboBox>
                </div>
                <div class="flex-container-row align-center padded" *ngIf="showOwnerComboBox">
                    <label class="label label-width">Analysis Owner</label>
                    <jqxComboBox class="inlineComboBox" [width]="350" [placeHolder]="'Select an Owner...'"
                                 [source]="ownerList" [displayMember]="this.prefService.userDisplayField" [valueMember]="'idAppUser'"
                                 (onSelect)="onUserSelect($event)" formControlName="analysisOwner">
                    </jqxComboBox>
                </div>
                <div class="flex-container-row align-center padded" *ngIf="!newAnalysisGroup">
                    <label class="label label-width">Analysis Group</label>
                    <jqxComboBox #analysisGroupCombo class="inlineComboBox" [width]="350" [placeHolder]="'...'"
                                 [source]="analysisGroupList" [displayMember]="'name'" [valueMember]="'idAnalysisGroup'"
                                 (onSelect)="onAnalysisGroupSelect($event)" formControlName="analysisGroup">
                    </jqxComboBox>
                </div>
                <div class="flex-container-row align-center padded">
                    <button mat-button
                            class="link-button underlined minimize limit-width"
                            style="padding: 0;"
                            (click)="includeNewGroup()">New...
                    </button>
                </div>
                <div class="flex-container-row align-center padded" *ngIf="newAnalysisGroup">
                    <label class="label label-width">New Analysis Group Name</label>
                    <mat-form-field>
                        <input matInput formControlName="analysisGroupName">
                        <mat-error *ngIf="newAnalysisGroup && createAnalysisForm.get('analysisGroupName').hasError('required')">
                            Analysis Group Name is required
                        </mat-error>
                    </mat-form-field>


                </div>

                <div class="flex-container-row align-center padded">
                    <label class="label label-width">Analysis Name</label>
                    <mat-form-field class="example-full-width">
                        <input matInput formControlName="analysisName">
                        <mat-error *ngIf="createAnalysisForm.get('analysisName').hasError('required')">
                            Analysis Name is required
                        </mat-error>
                    </mat-form-field>
                </div>
                <div class="flex-container-row align-center padded">
                    <label class="label label-width">Organism</label>
                    <jqxComboBox #organismCombo class="inlineComboBox" [width]="350" [placeHolder]="'Organism...'"
                                 [source]="activeOrganismList" [displayMember]="'display'" [valueMember]="'idOrganism'"
                                 (onSelect)="onOrganismSelect($event)" formControlName="organism">
                    </jqxComboBox>
                </div>
                <div class="flex-container-row align-center padded">
                    <button mat-button
                            class="link-button underlined minimize limit-width"
                            style="padding: 0;"
                            (click)="newOrganism()">New/Edit...
                    </button>
                </div>

                <div class="flex-container-row align-center padded">
                    <label class="label label-width">Genome Build</label>
                    <jqxComboBox class="inlineComboBox" [width]="350" [multiSelect]="true"
                                 [source]="genomeBuildList" [displayMember]="'display'" [valueMember]="'idGenomeBuild'"
                                 (onSelect)="onGenomeBuildSelect($event)">
                    </jqxComboBox>
                </div>
                <div class="flex-container-row align-center padded">
                    <button mat-button
                            class="link-button underlined minimize limit-width"
                            style="padding: 0;"
                            (click)="newGenomeBuild()">New/Edit...
                    </button>
                </div>

                <div class="flex-container-row align-center padded">
                    <label class="label label-width">Visibility</label>
                    <jqxComboBox class="inlineComboBox" [width]="350"
                                 [source]="visibilityList" [displayMember]="'display'" [valueMember]="'idGenomeBuild'"
                                 (onSelect)="onVisibilitySelect($event)" formControlName="visibility">
                    </jqxComboBox>
                </div>
            </form>
        </div>
        <div mat-dialog-actions class="no-padding no-margin">
            <div class="full-width right-align flex-container-row padded">
                <div class="full-height flex-grow">
                    <mat-spinner *ngIf="showSpinner" strokeWidth="3" [diameter]="30"></mat-spinner>
                </div>
                <div *ngIf="!showSpinner">
                    <button #yesButton mat-button [disabled]="createAnalysisForm.invalid" (click)="createAnalysisYesButtonClicked()">
                        <img class="icon" [src]="this.constantsService.ICON_SAVE">Save</button>
                    <button mat-button mat-dialog-close>Cancel</button>
                </div>
            </div>
        </div>
    </div>
</div>

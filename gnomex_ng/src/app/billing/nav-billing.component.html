<div class="full-height full-width">
    <billing-filter (onChange)="this.onFilterChange($event)"></billing-filter>
    <div class="flex-container-row padding height-eighty">
        <div class="full-height flex-three bordered">
            <mat-tab-group class="full-height">
                <mat-tab label="Billing Items">
                    <div [hidden]="!this.showFilterByOrderType">
                        <mat-radio-group [(ngModel)]="this.filterByOrderType" (change)="this.onFilterByOrderTypeChange()">
                            <mat-radio-button class="filter-by-order-type-opt" [value]="this.FILTER_ALL">Show All</mat-radio-button>
                            <mat-radio-button [hidden]="!this.showFilterByExp" class="filter-by-order-type-opt" [value]="this.FILTER_EXP">Experiments</mat-radio-button>
                            <mat-radio-button [hidden]="!this.showFilterByDsk" class="filter-by-order-type-opt" [value]="this.FILTER_DSK">Disk</mat-radio-button>
                            <mat-radio-button [hidden]="!this.showFilterByPo" class="filter-by-order-type-opt" [value]="this.FILTER_PO">Products</mat-radio-button>
                        </mat-radio-group>
                    </div>
                    <div [hidden]="!this.showJumpToPending && !this.showJumpToCompleted && !this.showJumpToApproved">
                        <button mat-button [hidden]="!this.showJumpToPending" (click)="this.jumpTo(this.STATUS_PENDING)">Pending</button>
                        <button mat-button [hidden]="!this.showJumpToCompleted" (click)="this.jumpTo(this.STATUS_COMPLETED)">Completed</button>
                        <button mat-button [hidden]="!this.showJumpToApproved" (click)="this.jumpTo(this.STATUS_APPROVED)">Approved</button>
                    </div>
                    <div class="height-eighty">
                        <tree-root #tree [nodes]="this.billingItemsTreeNodes" [options]="this.billingItemsTreeOptions" (activate)="this.onBillingItemsTreeActivate($event)">
                            <ng-template #treeNodeTemplate  let-node>
                                <img src="{{node?.data?.icon}}" class="icon">
                                <span>{{ node?.data?.display }}</span>
                            </ng-template>
                        </tree-root>
                    </div>
                    <div>
                        <button mat-button (click)="this.toggleExpandLabs()">{{this.expandLabs ? 'Expand Labs' : 'Collapse Labs'}}</button>
                        <mat-checkbox [(ngModel)]="this.hideEmptyRequests" (change)="this.onHideEmptyRequestsChange($event)">Hide requests with no billing items?</mat-checkbox>
                    </div>
                </mat-tab>
                <mat-tab label="Prices">
                    <div>
                        <button *ngFor="let sheet of this.priceTreeGridData" mat-button class="minimize font-small price-sheet-link" (click)="this.jumpToPriceSheet(sheet.idPriceSheet)">{{sheet.display}}</button>
                    </div>
                    <div class="flex-container-row align-center justify-space-between">
                        <label class="font-small padding-left no-margin" matTooltip="Drag-and-drop price category to reorder or attach to another price sheet" [matTooltipPosition]="'right'"><img class="icon" src="../../assets/information.png">Drag-and-drop hint</label>
                        <button mat-button matTooltip="Create a new billing item with the selected price for the selected experiment" [matTooltipPosition]="'right'" [disabled]="this.disableAddBillingItemButton" (click)="this.addNewBillingItem()" class="font-small"><img src="../../assets/add.png" class="icon">Create new billing item</button>
                    </div>
                    <div class="height-seventy-five">
                        <ag-grid-angular class="ag-theme-balham full-height full-width font-small"
                                         (gridReady)="this.onPriceTreeGridReady($event)"
                                         (gridSizeChanged)="this.onGridSizeChanged($event)"
                                         (rowClicked)="this.onPriceTreeGridSelection($event)"
                                         (rowDragEnd)="this.onPriceTreeGridDragEnd($event)"
                                         [getNodeChildDetails]="this.getPriceNodeChildDetails"
                                         [enableColResize]="true"
                                         [rowData]="this.priceTreeGridData">
                        </ag-grid-angular>
                    </div>
                    <div class="flex-container-row">
                        <mat-checkbox [(ngModel)]="this.showPricesCheckbox" (change)="this.refreshPricingGrid()" class="padding-left font-small">Show prices</mat-checkbox>
                        <mat-checkbox [(ngModel)]="this.showPriceCriteriaCheckbox" (change)="this.refreshPricingGrid()" class="padding-left font-small">Show price criteria</mat-checkbox>
                        <mat-checkbox [(ngModel)]="this.showInactivePricesCheckbox" (change)="this.refreshPricingGrid()" class="padding-left font-small">Show inactive prices</mat-checkbox>
                    </div>
                    <div class="flex-container-row">
                        <button mat-button (click)="this.openNewSheetWindow()" class="font-small"><img src="../../assets/pricesheet_add.png" class="icon">New sheet</button>
                        <button mat-button (click)="this.openNewCategoryWindow()" class="font-small"><img src="../../assets/folder_money_add.png" class="icon">New category</button>
                        <button mat-button (click)="this.openNewPriceWindow()" class="font-small"><img src="../../assets/money_add.png" class="icon">New price</button>
                        <button mat-button [disabled]="!this.selectedPriceTreeGridItem" (click)="this.removeFromPriceTree()" class="font-small"><img src="../../assets/delete.png" class="icon">Remove</button>
                    </div>
                </mat-tab>
            </mat-tab-group>
        </div>
        <div class="full-height padding flex-seven flex-container-col">
            <div class="flex-container-row justify-space-between align-center flex-one">
                <label>Billing Items {{this.billingItemGridLabel}}</label>
                <mat-checkbox [(ngModel)]="this.showRelatedCharges" (change)="this.onShowRelatedChargesChange($event)"
                              matTooltip="When a request has billing items spanning multiple billing periods or split with other accounts, show the related charges">Show Related Charges</mat-checkbox>
            </div>
            <div class="flex-container-row align-center flex-one justify-space-between">
                <label>{{this.invoiceLabel}}</label>
                <div class="flex-container-row">
                    <button mat-button matTooltip="This will move all the selected items to the next billing period. If no items are selected, all of the displayed items will be updated" (click)="this.onMoveToNextPeriod()">Move to next billing period</button>
                    <mat-form-field matTooltip="This will update the status for all the selected items. If no items are selected, all of the displayed items' statuses will update">
                        <mat-select [(ngModel)]="this.changeStatusValue" placeholder="Change Status" (change)="this.onChangeStatus()">
                            <mat-option>None</mat-option>
                            <mat-option *ngFor="let status of this.statusListShort" [value]="status.codeBillingStatus">{{status.display}}</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
            </div>
            <div class="flex-ten">
                <ag-grid-angular class="ag-theme-balham full-height full-width font-small"
                                 (gridReady)="this.onBillingItemGridReady($event)"
                                 (gridSizeChanged)="this.onGridSizeChanged($event)"
                                 (cellValueChanged)="this.onBillingItemGridChange($event)"
                                 (selectionChanged)="this.onBillingItemGridSelection()"
                                 (rowClicked)="this.onBillingItemGridRowSelection($event)"
                                 [getNodeChildDetails]="this.getBillingItemNodeChildDetails"
                                 [rowSelection]="'multiple'"
                                 [singleClickEdit]="true"
                                 [rowClassRules]="this.billingItemGridRowClassRules"
                                 [rowData]="this.billingItemGridData">
                </ag-grid-angular>
            </div>
            <div class="flex-container-row align-center flex-one justify-space-between">
                <div>
                    <button mat-button [disabled]="this.disableSplitButton" color="accent" (click)="this.openSplitWindow()"><img src="../../assets/account_split.png" class="icon">Reassign/Split</button>
                    <button mat-button [disabled]="this.selectedBillingItems.length < 1" color="warn" (click)="this.removeBillingItems()"><img src="../../assets/delete.png" class="icon">Remove</button>
                    <span *ngIf="this.showDirtyNote" class="dirtyNote">Changes Have Not Been Saved</span>
                </div>
                <button mat-button color="primary" (click)="this.validateAndSave()"><img src="../../assets/action_save.gif" class="icon">Save</button>
            </div>
        </div>
    </div>
</div>
